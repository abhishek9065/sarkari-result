src/config.ts:import dotenv from 'dotenv';
src/middleware/auth.ts:import { Request, Response, NextFunction } from 'express';
src/middleware/auth.ts:import jwt, { VerifyOptions } from 'jsonwebtoken';
src/middleware/auth.ts:import { config } from '../config.js';
src/middleware/auth.ts:import { UserModelMongo } from '../models/users.mongo.js';
src/middleware/auth.ts:import { validateAdminStepUpToken, ADMIN_STEP_UP_HEADER } from '../services/adminStepUp.js';
src/middleware/auth.ts:import { isAdminPortalRole } from '../services/adminPermissions.js';
src/middleware/auth.ts:import { hasPermission, type Permission } from '../services/rbac.js';
src/middleware/auth.ts:import { touchAdminSession, validateAdminSession } from '../services/adminSessions.js';
src/middleware/auth.ts:import RedisCache from '../services/redis.js';
src/middleware/auth.ts:import { JwtPayload } from '../types.js';
src/middleware/cache.ts:import { Request, Response, NextFunction } from 'express';
src/middleware/cache.ts:import { getCacheVersion } from '../services/cacheVersion.js';
src/middleware/cache.ts:import { RedisCache } from '../services/redis.js';
src/middleware/cache.ts:import { getCache, setCache } from '../utils/cache.js';
src/middleware/cacheControl.ts:import { Request, Response, NextFunction } from 'express';
src/middleware/cloudflare.ts:import { Request, Response, NextFunction } from 'express';
src/middleware/csrf.ts:import crypto from 'crypto';
src/middleware/csrf.ts:import { NextFunction, Request, Response } from 'express';
src/middleware/csrf.ts:import { config } from '../config.js';
src/middleware/errorHandler.ts:import { Request, Response, NextFunction } from 'express';
src/middleware/errorHandler.ts:import { ZodError } from 'zod';
src/middleware/errorHandler.ts:import { ErrorTracking } from '../services/errorTracking.js';
src/middleware/errorHandler.ts:import { AppError } from '../utils/AppError.js';
src/middleware/errorHandler.ts:import logger from '../utils/logger.js';
src/middleware/idempotency.ts:import { Request, Response, NextFunction } from 'express';
src/middleware/rateLimit.ts:import { Request, Response, NextFunction } from 'express';
src/middleware/rateLimit.ts:import { SecurityLogger } from '../services/securityLogger.js';
src/middleware/rateLimit.ts:import { getRealIp } from './cloudflare.js';
src/middleware/responseTime.ts:import { Request, Response, NextFunction } from 'express';
src/middleware/responseTime.ts:import { recordActiveUser } from '../services/activeUsers.js';
src/middleware/security.ts:import { Request, Response, NextFunction } from 'express';
src/middleware/security.ts:import helmet from 'helmet';
src/middleware/security.ts:import { config } from '../config.js';
src/middleware/security.ts:import RedisCache from '../services/redis.js';
src/middleware/security.ts:import { SecurityLogger } from '../services/securityLogger.js';
src/models/announcements.mongo.ts:import { ObjectId, Filter, Sort, WithId, Document } from 'mongodb';
src/models/announcements.mongo.ts:import { getCollection } from '../services/cosmosdb.js';
src/models/announcements.mongo.ts:import { Announcement, AnnouncementStatus, ContentType, CreateAnnouncementDto } from '../types.js';
src/models/bookmarks.mongo.ts:import { ObjectId, Document } from 'mongodb';
src/models/bookmarks.mongo.ts:import { getCollection } from '../services/cosmosdb.js';
src/models/mockData.ts:import { Announcement, ContentType } from '../types.js';
src/models/users.mongo.ts:import bcrypt from 'bcryptjs';
src/models/users.mongo.ts:import { ObjectId, WithId, Document } from 'mongodb';
src/models/users.mongo.ts:import { getCollection } from '../services/cosmosdb.js';
src/routes/admin-setup.ts:import { Router, type Response } from 'express';
src/routes/admin-setup.ts:import { z } from 'zod';
src/routes/admin-setup.ts:import { config } from '../config.js';
src/routes/admin-setup.ts:import { UserModelMongo } from '../models/users.mongo.js';
src/routes/admin-setup.ts:import { SecurityLogger } from '../services/securityLogger.js';
src/routes/admin.ts:import { Router } from 'express';
src/routes/admin.ts:import { z } from 'zod';
src/routes/admin.ts:import { authenticateToken, requireAdminStepUp, requirePermission } from '../middleware/auth.js';
src/routes/admin.ts:import { idempotency } from '../middleware/idempotency.js';
src/routes/admin.ts:import { AnnouncementModelMongo } from '../models/announcements.mongo.js';
src/routes/admin.ts:import { getActiveUsersStats } from '../services/activeUsers.js';
src/routes/admin.ts:import {
src/routes/admin.ts:import { evaluateAdminApprovalRequirement } from '../services/adminApprovalPolicy.js';
src/routes/admin.ts:import { getAdminAuditLogsPaged, recordAdminAudit } from '../services/adminAudit.js';
src/routes/admin.ts:import { getDailyRollups } from '../services/analytics.js';
src/routes/admin.ts:import { getCollection } from '../services/cosmosdb.js';
src/routes/admin.ts:import { hasPermission } from '../services/rbac.js';
src/routes/admin.ts:import { SecurityLogger } from '../services/securityLogger.js';
src/routes/admin.ts:import { getAdminSession, listAdminSessions, mapSessionForClient, terminateAdminSession, terminateOtherSessions } from '../services/adminSessions.js';
src/routes/admin.ts:import { ContentType, CreateAnnouncementDto } from '../types.js';
src/routes/analytics.ts:import { Router } from 'express';
src/routes/analytics.ts:import { z } from 'zod';
src/routes/analytics.ts:import { authenticateToken, requirePermission } from '../middleware/auth.js';
src/routes/analytics.ts:import { AnnouncementModelMongo } from '../models/announcements.mongo.js';
src/routes/analytics.ts:import { getDailyRollups, getRollupSummary } from '../services/analytics.js';
src/routes/analytics.ts:import { getAnalyticsOverview } from '../services/analyticsOverview.js';
src/routes/announcements.ts:import express from 'express';
src/routes/announcements.ts:import { z } from 'zod';
src/routes/announcements.ts:import { authenticateToken, requirePermission } from '../middleware/auth.js';
src/routes/announcements.ts:import { cacheMiddleware, cacheKeys } from '../middleware/cache.js';
src/routes/announcements.ts:import { cacheControl } from '../middleware/cacheControl.js';
src/routes/announcements.ts:import { AnnouncementModelMongo as AnnouncementModel } from '../models/announcements.mongo.js';
src/routes/announcements.ts:import { recordAnnouncementView, recordAnalyticsEvent } from '../services/analytics.js';
src/routes/announcements.ts:import { bumpCacheVersion } from '../services/cacheVersion.js';
src/routes/announcements.ts:import { sendAnnouncementNotification } from '../services/telegram.js';
src/routes/announcements.ts:import { Announcement, ContentType, CreateAnnouncementDto } from '../types.js';
src/routes/auth.ts:import crypto from 'crypto';
src/routes/auth.ts:import express from 'express';
src/routes/auth.ts:import jwt, { SignOptions } from 'jsonwebtoken';
src/routes/auth.ts:import { z } from 'zod';
src/routes/auth.ts:import { config } from '../config.js';
src/routes/auth.ts:import { ADMIN_AUTH_COOKIE_NAME, AUTH_COOKIE_NAME, blacklistToken, isTokenBlacklisted } from '../middleware/auth.js';
src/routes/auth.ts:import { clearCsrfCookie, ensureCsrfCookie, setCsrfCookie } from '../middleware/csrf.js';
src/routes/auth.ts:import {
src/routes/auth.ts:import { UserModelMongo } from '../models/users.mongo.js';
src/routes/auth.ts:import { recordAnalyticsEvent } from '../services/analytics.js';
src/routes/auth.ts:import { createAdminSession, isNewDeviceForUser, terminateAdminSession, terminateOtherSessions } from '../services/adminSessions.js';
src/routes/auth.ts:import { clearAuthAbuseFailures, getAuthAbuseStatus, recordAuthAbuseFailure } from '../services/authAbuse.js';
src/routes/auth.ts:import {
src/routes/auth.ts:import { issueAdminStepUpToken } from '../services/adminStepUp.js';
src/routes/auth.ts:import { sendAdminNewDeviceLoginEmail, sendAdminPasswordResetEmail, sendAdminSecurityAlertEmail } from '../services/email.js';
src/routes/auth.ts:import { checkPasswordSecurity } from '../services/passwordSecurity.js';
src/routes/auth.ts:import RedisCache from '../services/redis.js';
src/routes/auth.ts:import { SecurityLogger } from '../services/securityLogger.js';
src/routes/auth.ts:import { JwtPayload } from '../types.js';
src/routes/auth.ts:import { decryptSecret, encryptSecret } from '../utils/crypto.js';
src/routes/auth.ts:import { generateBackupCodes, hashBackupCode, normalizeBackupCode } from '../utils/backupCodes.js';
src/routes/auth.ts:import { generateTotpSecret, verifyTotpCode } from '../utils/totp.js';
src/routes/bookmarks.ts:import { Router, Request, Response } from 'express';
src/routes/bookmarks.ts:import { z } from 'zod';
src/routes/bookmarks.ts:import { authenticateToken, optionalAuth } from '../middleware/auth.js';
src/routes/bookmarks.ts:import { AnnouncementModelMongo } from '../models/announcements.mongo.js';
src/routes/bookmarks.ts:import { BookmarkModelMongo } from '../models/bookmarks.mongo.js';
src/routes/bookmarks.ts:import { recordAnalyticsEvent } from '../services/analytics.js';
src/routes/bulk.ts:import { Router } from 'express';
src/routes/bulk.ts:import { z } from 'zod';
src/routes/bulk.ts:import { authenticateToken, requirePermission } from '../middleware/auth.js';
src/routes/bulk.ts:import { AnnouncementModelMongo } from '../models/announcements.mongo.js';
src/routes/bulk.ts:import { ContentType } from '../types.js';
src/routes/community.ts:import { Router } from 'express';
src/routes/community.ts:import { z } from 'zod';
src/routes/community.ts:import { authenticateToken, optionalAuth, requirePermission } from '../middleware/auth.js';
src/routes/community.ts:import { getCollection, isValidObjectId, toObjectId } from '../services/cosmosdb.js';
src/routes/graphql.ts:import { Router } from 'express';
src/routes/graphql.ts:import { graphql, buildSchema } from 'graphql';
src/routes/graphql.ts:import { authenticateToken, requirePermission } from '../middleware/auth.js';
src/routes/graphql.ts:import { AnnouncementModelMongo } from '../models/announcements.mongo.js';
src/routes/graphql.ts:import { getActiveUsersStats } from '../services/activeUsers.js';
src/routes/graphql.ts:import { getAnalyticsOverview } from '../services/analyticsOverview.js';
src/routes/graphql.ts:import { hasPermission } from '../services/rbac.js';
src/routes/jobs.ts:import { Router } from 'express';
src/routes/jobs.ts:import { z } from 'zod';
src/routes/jobs.ts:import { cacheMiddleware, cacheKeys } from '../middleware/cache.js';
src/routes/jobs.ts:import { AnnouncementModelMongo } from '../models/announcements.mongo.js';
src/routes/profile.ts:import { Router } from 'express';
src/routes/profile.ts:import { z } from 'zod';
src/routes/profile.ts:import { authenticateToken } from '../middleware/auth.js';
src/routes/profile.ts:import { AnnouncementModelMongo } from '../models/announcements.mongo.js';
src/routes/profile.ts:import { recordAnalyticsEvent } from '../services/analytics.js';
src/routes/profile.ts:import { getCollection, isValidObjectId, toObjectId } from '../services/cosmosdb.js';
src/routes/profile.ts:import { ContentType } from '../types.js';
src/routes/push.ts:import { Router } from 'express';
src/routes/push.ts:import { z } from 'zod';
src/routes/push.ts:import { config } from '../config.js';
src/routes/push.ts:import { optionalAuth } from '../middleware/auth.js';
src/routes/push.ts:import { getCollection } from '../services/cosmosdb.js';
src/routes/subscriptions.ts:import { randomBytes } from 'crypto';
src/routes/subscriptions.ts:import { Router } from 'express';
src/routes/subscriptions.ts:import { z } from 'zod';
src/routes/subscriptions.ts:import { recordAnalyticsEvent } from '../services/analytics.js';
src/routes/subscriptions.ts:import { getCollection } from '../services/cosmosdb.js';
src/routes/subscriptions.ts:import { isEmailConfigured, sendVerificationEmail } from '../services/email.js';
src/routes/support.ts:import { Router } from 'express';
src/routes/support.ts:import { z } from 'zod';
src/routes/support.ts:import { authenticateToken, optionalAuth, requirePermission } from '../middleware/auth.js';
src/routes/support.ts:import { getCollection, isValidObjectId, toObjectId } from '../services/cosmosdb.js';
src/routes/support.ts:import ErrorTracking from '../services/errorTracking.js';
src/scripts/verify-performance.ts:import { Request } from 'express';
src/scripts/verify-performance.ts:import { rateLimit } from '../middleware/rateLimit.js';
src/scripts/verify-performance.ts:import { setCache, getCache } from '../utils/cache.js';
src/server.ts:import fs from 'fs';
src/server.ts:import http from 'http';
src/server.ts:import path from 'path';
src/server.ts:import compression from 'compression';
src/server.ts:import cookieParser from 'cookie-parser';
src/server.ts:import cors from 'cors';
src/server.ts:import express from 'express';
src/server.ts:import swaggerUi from 'swagger-ui-express';
src/server.ts:import { config } from './config.js';
src/server.ts:import { authenticateToken, requirePermission } from './middleware/auth.js';
src/server.ts:import { cloudflareMiddleware } from './middleware/cloudflare.js';
src/server.ts:import { csrfProtection } from './middleware/csrf.js';
src/server.ts:import { errorHandler } from './middleware/errorHandler.js';
src/server.ts:import { rateLimit } from './middleware/rateLimit.js';
src/server.ts:import { responseTimeLogger, getPerformanceStats } from './middleware/responseTime.js';
src/server.ts:import {
src/server.ts:import adminSetupRouter from './routes/admin-setup.js';
src/server.ts:import adminRouter from './routes/admin.js';
src/server.ts:import analyticsRouter from './routes/analytics.js';
src/server.ts:import announcementsRouter from './routes/announcements.js';
src/server.ts:import authRouter from './routes/auth.js';
src/server.ts:import bookmarksRouter from './routes/bookmarks.js';
src/server.ts:import bulkRouter from './routes/bulk.js';
src/server.ts:import communityRouter from './routes/community.js';
src/server.ts:import graphqlRouter from './routes/graphql.js';
src/server.ts:import jobsRouter from './routes/jobs.js';
src/server.ts:import profileRouter from './routes/profile.js';
src/server.ts:import pushRouter from './routes/push.js';
src/server.ts:import subscriptionsRouter from './routes/subscriptions.js';
src/server.ts:import supportRouter from './routes/support.js';
src/server.ts:import { scheduleAnalyticsRollups } from './services/analytics.js';
src/server.ts:import { startAnalyticsWebSocket } from './services/analyticsStream.js';
src/server.ts:import { scheduleAdminApprovalsCleanup } from './services/adminApprovals.js';
src/server.ts:import { connectToDatabase, healthCheck } from './services/cosmosdb.js';
src/server.ts:import { ErrorTracking } from './services/errorTracking.js';
src/server.ts:import logger from './utils/logger.js';
src/services/activeUsers.ts:import type { Request } from 'express';
src/services/activeUsers.ts:import type { UserRole } from '../types.js';
src/services/adminApprovalPolicy.ts:import { config } from '../config.js';
src/services/adminApprovalPolicy.ts:import type { ContentType } from '../types.js';
src/services/adminApprovalPolicy.ts:import type { AdminApprovalActionType } from './adminApprovals.js';
src/services/adminApprovals.ts:import crypto from 'crypto';
src/services/adminApprovals.ts:import { ObjectId } from 'mongodb';
src/services/adminApprovals.ts:import { config } from '../config.js';
src/services/adminApprovals.ts:import { getCollection } from './cosmosdb.js';
src/services/adminAudit.ts:import { getCollection } from './cosmosdb.js';
src/services/adminPermissions.ts:import type { UserRole } from '../types.js';
src/services/adminSessions.ts:import crypto from 'crypto';
src/services/adminSessions.ts:import { config } from '../config.js';
src/services/adminStepUp.ts:import crypto from 'crypto';
src/services/adminStepUp.ts:import jwt from 'jsonwebtoken';
src/services/adminStepUp.ts:import { config } from '../config.js';
src/services/adminStepUp.ts:import RedisCache from './redis.js';
src/services/analytics.ts:import type { Collection } from 'mongodb';
src/services/analytics.ts:import { getCollection } from './cosmosdb.js';
src/services/analyticsOverview.ts:import { AnnouncementModelMongo } from '../models/announcements.mongo.js';
src/services/analyticsOverview.ts:import { getDailyRollups, getRollupSummary, getCtrByType, getDigestClickStats, getDeepLinkAttribution, getTopSearches } from './analytics.js';
src/services/analyticsOverview.ts:import { getCollection } from './cosmosdb.js';
src/services/analyticsStream.ts:import type { Server } from 'http';
src/services/analyticsStream.ts:import jwt, { VerifyOptions } from 'jsonwebtoken';
src/services/analyticsStream.ts:import { WebSocketServer } from 'ws';
src/services/analyticsStream.ts:import { config } from '../config.js';
src/services/analyticsStream.ts:import { ADMIN_AUTH_COOKIE_NAME, AUTH_COOKIE_NAME } from '../middleware/auth.js';
src/services/analyticsStream.ts:import { getClientIP } from '../middleware/security.js';
src/services/analyticsStream.ts:import { getAnalyticsOverview } from './analyticsOverview.js';
src/services/analyticsStream.ts:import { hasPermission } from './rbac.js';
src/services/analyticsStream.ts:import { SecurityLogger } from './securityLogger.js';
src/services/authAbuse.ts:import RedisCache from './redis.js';
src/services/cacheVersion.ts:import { RedisCache } from './redis.js';
src/services/cosmosdb.ts:import { MongoClient, Db, Collection, ObjectId } from 'mongodb';
src/services/email.ts:import sgMail from '@sendgrid/mail';
src/services/email.ts:import { config } from '../config.js';
src/services/email.ts:import { Announcement } from '../types.js';
src/services/emailService.ts:import { Announcement } from '../types.js';
src/services/errorTracking.ts:import * as Sentry from '@sentry/node';
src/services/passwordSecurity.ts:import crypto from 'crypto';
src/services/passwordSecurity.ts:import { config } from '../config.js';
src/services/rbac.ts:import type { UserRole } from '../types.js';
src/services/rbac.ts:import { ADMIN_ROLE_PERMISSIONS } from './adminPermissions.js';
src/services/redis.ts:import { getCache as getMemoryCache, setCache as setMemoryCache, deleteCache as deleteMemoryCache, invalidateCache } from '../utils/cache.js';
src/services/securityLogger.ts:import { ObjectId } from 'mongodb';
src/services/securityLogger.ts:import { config } from '../config.js';
src/services/securityLogger.ts:import { getCollectionAsync } from './cosmosdb.js';
src/services/telegram.ts:import { config } from '../config.js';
src/services/telegram.ts:import { Announcement } from '../types.js';
src/tests/adminApprovals.test.ts:import { ObjectId } from 'mongodb';
src/tests/adminApprovals.test.ts:import { describe, expect, it } from 'vitest';
src/tests/adminApprovals.test.ts:import {
src/tests/adminApprovals.test.ts:import { getCollection } from '../services/cosmosdb.js';
src/tests/adminPostLogin.contract.test.ts:import express from 'express';
src/tests/adminPostLogin.contract.test.ts:import request from 'supertest';
src/tests/adminPostLogin.contract.test.ts:import { beforeEach, describe, expect, it, vi } from 'vitest';
src/tests/adminPostLogin.contract.test.ts:import adminRouter from '../routes/admin.js';
src/tests/adminSetup.test.ts:import express from 'express';
src/tests/adminSetup.test.ts:import request from 'supertest';
src/tests/adminSetup.test.ts:import { afterEach, beforeEach, describe, expect, it, vi } from 'vitest';
src/tests/adminSetup.test.ts:import { UserModelMongo } from '../models/users.mongo.js';
src/tests/adminSetup.test.ts:import adminSetupRouter from '../routes/admin-setup.js';
src/tests/adminStepUp.test.ts:import jwt from 'jsonwebtoken';
src/tests/adminStepUp.test.ts:import { beforeEach, describe, expect, it } from 'vitest';
src/tests/adminStepUp.test.ts:import { config } from '../config.js';
src/tests/adminStepUp.test.ts:import { issueAdminStepUpToken, validateAdminStepUpToken } from '../services/adminStepUp.js';
src/tests/adminStepUp.test.ts:import RedisCache from '../services/redis.js';
src/tests/auth.test.ts:import crypto from 'crypto';
src/tests/auth.test.ts:import cookieParser from 'cookie-parser';
src/tests/auth.test.ts:import express from 'express';
src/tests/auth.test.ts:import jwt from 'jsonwebtoken';
src/tests/auth.test.ts:import request from 'supertest';
src/tests/auth.test.ts:import { beforeEach, describe, expect, it, vi } from 'vitest';
src/tests/auth.test.ts:import { UserModelMongo } from '../models/users.mongo.js';
src/tests/auth.test.ts:import authRouter from '../routes/auth.js';
src/tests/auth.test.ts:import RedisCache from '../services/redis.js';
src/tests/cacheMiddleware.test.ts:import express from 'express';
src/tests/cacheMiddleware.test.ts:import request from 'supertest';
src/tests/cacheMiddleware.test.ts:import { beforeEach, describe, expect, it } from 'vitest';
src/tests/cacheMiddleware.test.ts:import { cacheMiddleware } from '../middleware/cache.js';
src/tests/cacheMiddleware.test.ts:import { bumpCacheVersion } from '../services/cacheVersion.js';
src/tests/cacheMiddleware.test.ts:import { invalidateCache } from '../utils/cache.js';
src/tests/securityLogger.test.ts:import { describe, expect, it, vi } from 'vitest';
src/utils/backupCodes.ts:import crypto from 'crypto';
src/utils/backupCodes.ts:import { config } from '../config.js';
src/utils/crypto.ts:import crypto from 'crypto';
src/utils/crypto.ts:import { config } from '../config.js';
src/utils/logger.ts:import pino from 'pino';
src/utils/logger.ts:import { config } from '../config.js';
src/utils/totp.ts:import { authenticator } from 'otplib';
src/utils/totp.ts:import qrcode from 'qrcode';
src/utils/totp.ts:import { config } from '../config.js';
