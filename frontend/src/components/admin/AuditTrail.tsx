import React, { useState, useEffect } from 'react';\nimport './AuditTrail.css';\n\nexport interface AuditEvent {\n    id: string;\n    timestamp: string;\n    userId: string;\n    userName: string;\n    userEmail: string;\n    action: string;\n    resource: string;\n    resourceId: string;\n    details: Record<string, any>;\n    ipAddress: string;\n    userAgent: string;\n    location?: {\n        country: string;\n        city: string;\n        region: string;\n    };\n    severity: 'low' | 'medium' | 'high' | 'critical';\n    category: 'authentication' | 'authorization' | 'data' | 'system' | 'security' | 'admin';\n    status: 'success' | 'failure' | 'warning' | 'info';\n    metadata?: Record<string, any>;\n}\n\nexport interface AuditFilters {\n    dateFrom: string;\n    dateTo: string;\n    userId: string;\n    action: string;\n    resource: string;\n    severity: string[];\n    category: string[];\n    status: string[];\n    ipAddress: string;\n    searchQuery: string;\n}\n\nexport interface AuditStats {\n    totalEvents: number;\n    criticalEvents: number;\n    failedAttempts: number;\n    uniqueUsers: number;\n    topActions: Array<{ action: string; count: number }>;\n    topResources: Array<{ resource: string; count: number }>;\n    eventsByHour: Array<{ hour: string; count: number }>;\n    eventsByCategory: Array<{ category: string; count: number }>;\n}\n\ninterface AuditTrailProps {\n    events: AuditEvent[];\n    stats: AuditStats;\n    loading?: boolean;\n    onExport?: (filters: AuditFilters) => Promise<void>;\n    onRefresh?: () => Promise<void>;\n    onFilterChange?: (filters: AuditFilters) => void;\n    autoRefresh?: boolean;\n    refreshInterval?: number;\n}\n\nconst SEVERITY_COLORS = {\n    low: '#22c55e',\n    medium: '#eab308',\n    high: '#f97316',\n    critical: '#ef4444'\n};\n\nconst STATUS_COLORS = {\n    success: '#22c55e',\n    failure: '#ef4444',\n    warning: '#eab308',\n    info: '#3b82f6'\n};\n\nconst CATEGORY_ICONS = {\n    authentication: 'üîê',\n    authorization: 'üõ°Ô∏è',\n    data: 'üìä',\n    system: '‚öôÔ∏è',\n    security: 'üîí',\n    admin: 'üëë'\n};\n\nexport function AuditTrail({ \n    events, \n    stats, \n    loading = false, \n    onExport,\n    onRefresh,\n    onFilterChange,\n    autoRefresh = false,\n    refreshInterval = 30000\n}: AuditTrailProps) {\n    const [filters, setFilters] = useState<AuditFilters>({\n        dateFrom: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\n        dateTo: new Date().toISOString().split('T')[0],\n        userId: '',\n        action: '',\n        resource: '',\n        severity: [],\n        category: [],\n        status: [],\n        ipAddress: '',\n        searchQuery: ''\n    });\n    \n    const [selectedEvent, setSelectedEvent] = useState<AuditEvent | null>(null);\n    const [viewMode, setViewMode] = useState<'table' | 'timeline' | 'chart'>('table');\n    const [expandedRows, setExpandedRows] = useState<Set<string>>(new Set());\n    const [sortConfig, setSortConfig] = useState<{ key: keyof AuditEvent; direction: 'asc' | 'desc' }>({ \n        key: 'timestamp', \n        direction: 'desc' \n    });\n\n    // Auto-refresh functionality\n    useEffect(() => {\n        if (autoRefresh && onRefresh) {\n            const interval = setInterval(onRefresh, refreshInterval);\n            return () => clearInterval(interval);\n        }\n    }, [autoRefresh, refreshInterval, onRefresh]);\n\n    // Filter change handler\n    useEffect(() => {\n        if (onFilterChange) {\n            onFilterChange(filters);\n        }\n    }, [filters, onFilterChange]);\n\n    const handleFilterChange = (key: keyof AuditFilters, value: any) => {\n        setFilters(prev => ({ ...prev, [key]: value }));\n    };\n\n    const handleArrayFilterChange = (key: 'severity' | 'category' | 'status', value: string) => {\n        setFilters(prev => {\n            const currentArray = prev[key] as string[];\n            const newArray = currentArray.includes(value)\n                ? currentArray.filter(item => item !== value)\n                : [...currentArray, value];\n            return { ...prev, [key]: newArray };\n        });\n    };\n\n    const handleSort = (key: keyof AuditEvent) => {\n        setSortConfig(prev => ({\n            key,\n            direction: prev.key === key && prev.direction === 'desc' ? 'asc' : 'desc'\n        }));\n    };\n\n    const sortedEvents = React.useMemo(() => {\n        return [...events].sort((a, b) => {\n            const aValue = a[sortConfig.key];\n            const bValue = b[sortConfig.key];\n            \n            if (aValue < bValue) return sortConfig.direction === 'asc' ? -1 : 1;\n            if (aValue > bValue) return sortConfig.direction === 'asc' ? 1 : -1;\n            return 0;\n        });\n    }, [events, sortConfig]);\n\n    const toggleRowExpansion = (eventId: string) => {\n        setExpandedRows(prev => {\n            const newSet = new Set(prev);\n            if (newSet.has(eventId)) {\n                newSet.delete(eventId);\n            } else {\n                newSet.add(eventId);\n            }\n            return newSet;\n        });\n    };\n\n    const getSeverityIcon = (severity: string) => {\n        switch (severity) {\n            case 'critical': return 'üö®';\n            case 'high': return '‚ö†Ô∏è';\n            case 'medium': return '‚ö°';\n            case 'low': return '‚ÑπÔ∏è';\n            default: return 'üìù';\n        }\n    };\n\n    const getStatusIcon = (status: string) => {\n        switch (status) {\n            case 'success': return '‚úÖ';\n            case 'failure': return '‚ùå';\n            case 'warning': return '‚ö†Ô∏è';\n            case 'info': return '‚ÑπÔ∏è';\n            default: return 'üìù';\n        }\n    };\n\n    const formatTimestamp = (timestamp: string) => {\n        return new Date(timestamp).toLocaleString();\n    };\n\n    const formatDetails = (details: Record<string, any>) => {\n        return Object.entries(details).map(([key, value]) => (\n            <div key={key} className=\"detail-item\">\n                <span className=\"detail-key\">{key}:</span>\n                <span className=\"detail-value\">{JSON.stringify(value)}</span>\n            </div>\n        ));\n    };\n\n    const handleExport = async () => {\n        if (onExport) {\n            await onExport(filters);\n        }\n    };\n\n    return (\n        <div className=\"audit-trail\">\n            <div className=\"audit-header\">\n                <div className=\"header-title\">\n                    <h2>üìã Enhanced Audit Trail</h2>\n                    <p>Comprehensive security and activity monitoring with advanced search and analytics</p>\n                </div>\n                \n                <div className=\"header-actions\">\n                    <div className=\"view-mode-selector\">\n                        <button \n                            className={`view-mode-btn ${viewMode === 'table' ? 'active' : ''}`}\n                            onClick={() => setViewMode('table')}\n                        >\n                            üìä Table\n                        </button>\n                        <button \n                            className={`view-mode-btn ${viewMode === 'timeline' ? 'active' : ''}`}\n                            onClick={() => setViewMode('timeline')}\n                        >\n                            üìà Timeline\n                        </button>\n                        <button \n                            className={`view-mode-btn ${viewMode === 'chart' ? 'active' : ''}`}\n                            onClick={() => setViewMode('chart')}\n                        >\n                            üìâ Analytics\n                        </button>\n                    </div>\n                    \n                    <div className=\"action-buttons\">\n                        {onRefresh && (\n                            <button \n                                className=\"refresh-btn\"\n                                onClick={onRefresh}\n                                disabled={loading}\n                            >\n                                üîÑ {loading ? 'Refreshing...' : 'Refresh'}\n                            </button>\n                        )}\n                        \n                        {onExport && (\n                            <button \n                                className=\"export-btn\"\n                                onClick={handleExport}\n                                disabled={loading}\n                            >\n                                üì• Export\n                            </button>\n                        )}\n                    </div>\n                </div>\n            </div>\n\n            {/* Statistics Overview */}\n            <div className=\"audit-stats\">\n                <div className=\"stats-grid\">\n                    <div className=\"stat-card total\">\n                        <div className=\"stat-icon\">üìä</div>\n                        <div className=\"stat-content\">\n                            <span className=\"stat-value\">{stats.totalEvents.toLocaleString()}</span>\n                            <span className=\"stat-label\">Total Events</span>\n                        </div>\n                    </div>\n                    \n                    <div className=\"stat-card critical\">\n                        <div className=\"stat-icon\">üö®</div>\n                        <div className=\"stat-content\">\n                            <span className=\"stat-value\">{stats.criticalEvents.toLocaleString()}</span>\n                            <span className=\"stat-label\">Critical Events</span>\n                        </div>\n                    </div>\n                    \n                    <div className=\"stat-card failed\">\n                        <div className=\"stat-icon\">‚ùå</div>\n                        <div className=\"stat-content\">\n                            <span className=\"stat-value\">{stats.failedAttempts.toLocaleString()}</span>\n                            <span className=\"stat-label\">Failed Attempts</span>\n                        </div>\n                    </div>\n                    \n                    <div className=\"stat-card users\">\n                        <div className=\"stat-icon\">üë•</div>\n                        <div className=\"stat-content\">\n                            <span className=\"stat-value\">{stats.uniqueUsers.toLocaleString()}</span>\n                            <span className=\"stat-label\">Unique Users</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            {/* Advanced Filters */}\n            <div className=\"audit-filters\">\n                <div className=\"filters-header\">\n                    <h3>üîç Advanced Filters</h3>\n                </div>\n                \n                <div className=\"filters-grid\">\n                    <div className=\"filter-group date-range\">\n                        <label>Date Range:</label>\n                        <div className=\"date-inputs\">\n                            <input\n                                type=\"date\"\n                                value={filters.dateFrom}\n                                onChange={(e) => handleFilterChange('dateFrom', e.target.value)}\n                                className=\"date-input\"\n                            />\n                            <span>to</span>\n                            <input\n                                type=\"date\"\n                                value={filters.dateTo}\n                                onChange={(e) => handleFilterChange('dateTo', e.target.value)}\n                                className=\"date-input\"\n                            />\n                        </div>\n                    </div>\n                    \n                    <div className=\"filter-group\">\n                        <label>Search:</label>\n                        <input\n                            type=\"text\"\n                            value={filters.searchQuery}\n                            onChange={(e) => handleFilterChange('searchQuery', e.target.value)}\n                            placeholder=\"Search events, users, actions...\"\n                            className=\"search-input\"\n                        />\n                    </div>\n                    \n                    <div className=\"filter-group\">\n                        <label>User ID:</label>\n                        <input\n                            type=\"text\"\n                            value={filters.userId}\n                            onChange={(e) => handleFilterChange('userId', e.target.value)}\n                            placeholder=\"Filter by user ID\"\n                            className=\"text-input\"\n                        />\n                    </div>\n                    \n                    <div className=\"filter-group\">\n                        <label>IP Address:</label>\n                        <input\n                            type=\"text\"\n                            value={filters.ipAddress}\n                            onChange={(e) => handleFilterChange('ipAddress', e.target.value)}\n                            placeholder=\"Filter by IP address\"\n                            className=\"text-input\"\n                        />\n                    </div>\n                    \n                    <div className=\"filter-group\">\n                        <label>Severity:</label>\n                        <div className=\"checkbox-group\">\n                            {['low', 'medium', 'high', 'critical'].map(severity => (\n                                <label key={severity} className=\"checkbox-label\">\n                                    <input\n                                        type=\"checkbox\"\n                                        checked={filters.severity.includes(severity)}\n                                        onChange={() => handleArrayFilterChange('severity', severity)}\n                                    />\n                                    <span className={`severity-badge ${severity}`}>\n                                        {getSeverityIcon(severity)} {severity.toUpperCase()}\n                                    </span>\n                                </label>\n                            ))}\n                        </div>\n                    </div>\n                    \n                    <div className=\"filter-group\">\n                        <label>Category:</label>\n                        <div className=\"checkbox-group\">\n                            {Object.keys(CATEGORY_ICONS).map(category => (\n                                <label key={category} className=\"checkbox-label\">\n                                    <input\n                                        type=\"checkbox\"\n                                        checked={filters.category.includes(category)}\n                                        onChange={() => handleArrayFilterChange('category', category)}\n                                    />\n                                    <span className=\"category-badge\">\n                                        {CATEGORY_ICONS[category as keyof typeof CATEGORY_ICONS]} {category.toUpperCase()}\n                                    </span>\n                                </label>\n                            ))}\n                        </div>\n                    </div>\n                    \n                    <div className=\"filter-group\">\n                        <label>Status:</label>\n                        <div className=\"checkbox-group\">\n                            {['success', 'failure', 'warning', 'info'].map(status => (\n                                <label key={status} className=\"checkbox-label\">\n                                    <input\n                                        type=\"checkbox\"\n                                        checked={filters.status.includes(status)}\n                                        onChange={() => handleArrayFilterChange('status', status)}\n                                    />\n                                    <span className={`status-badge ${status}`}>\n                                        {getStatusIcon(status)} {status.toUpperCase()}\n                                    </span>\n                                </label>\n                            ))}\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            {/* Events Display */}\n            <div className=\"audit-content\">\n                {viewMode === 'table' && (\n                    <div className=\"events-table-container\">\n                        <div className=\"table-controls\">\n                            <span className=\"results-count\">\n                                Showing {sortedEvents.length} events\n                            </span>\n                        </div>\n                        \n                        <div className=\"events-table\">\n                            <table>\n                                <thead>\n                                    <tr>\n                                        <th></th>\n                                        <th \n                                            className=\"sortable\"\n                                            onClick={() => handleSort('timestamp')}\n                                        >\n                                            Timestamp {sortConfig.key === 'timestamp' && (sortConfig.direction === 'asc' ? '‚Üë' : '‚Üì')}\n                                        </th>\n                                        <th \n                                            className=\"sortable\"\n                                            onClick={() => handleSort('userName')}\n                                        >\n                                            User {sortConfig.key === 'userName' && (sortConfig.direction === 'asc' ? '‚Üë' : '‚Üì')}\n                                        </th>\n                                        <th \n                                            className=\"sortable\"\n                                            onClick={() => handleSort('action')}\n                                        >\n                                            Action {sortConfig.key === 'action' && (sortConfig.direction === 'asc' ? '‚Üë' : '‚Üì')}\n                                        </th>\n                                        <th \n                                            className=\"sortable\"\n                                            onClick={() => handleSort('resource')}\n                                        >\n                                            Resource {sortConfig.key === 'resource' && (sortConfig.direction === 'asc' ? '‚Üë' : '‚Üì')}\n                                        </th>\n                                        <th>Category</th>\n                                        <th>Severity</th>\n                                        <th>Status</th>\n                                        <th>IP Address</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    {sortedEvents.map((event) => (\n                                        <React.Fragment key={event.id}>\n                                            <tr \n                                                className={`event-row ${expandedRows.has(event.id) ? 'expanded' : ''}`}\n                                                onClick={() => toggleRowExpansion(event.id)}\n                                            >\n                                                <td className=\"expand-cell\">\n                                                    <span className=\"expand-icon\">\n                                                        {expandedRows.has(event.id) ? '‚ñº' : '‚ñ∂'}\n                                                    </span>\n                                                </td>\n                                                <td className=\"timestamp-cell\">\n                                                    {formatTimestamp(event.timestamp)}\n                                                </td>\n                                                <td className=\"user-cell\">\n                                                    <div className=\"user-info\">\n                                                        <span className=\"user-name\">{event.userName}</span>\n                                                        <span className=\"user-email\">{event.userEmail}</span>\n                                                    </div>\n                                                </td>\n                                                <td className=\"action-cell\">\n                                                    <code>{event.action}</code>\n                                                </td>\n                                                <td className=\"resource-cell\">\n                                                    <span className=\"resource-name\">{event.resource}</span>\n                                                    {event.resourceId && (\n                                                        <span className=\"resource-id\">#{event.resourceId}</span>\n                                                    )}\n                                                </td>\n                                                <td className=\"category-cell\">\n                                                    <span className=\"category-badge\">\n                                                        {CATEGORY_ICONS[event.category]} {event.category}\n                                                    </span>\n                                                </td>\n                                                <td className=\"severity-cell\">\n                                                    <span \n                                                        className={`severity-badge ${event.severity}`}\n                                                        style={{ color: SEVERITY_COLORS[event.severity] }}\n                                                    >\n                                                        {getSeverityIcon(event.severity)} {event.severity}\n                                                    </span>\n                                                </td>\n                                                <td className=\"status-cell\">\n                                                    <span \n                                                        className={`status-badge ${event.status}`}\n                                                        style={{ color: STATUS_COLORS[event.status] }}\n                                                    >\n                                                        {getStatusIcon(event.status)} {event.status}\n                                                    </span>\n                                                </td>\n                                                <td className=\"ip-cell\">\n                                                    <code>{event.ipAddress}</code>\n                                                    {event.location && (\n                                                        <span className=\"location\">\n                                                            {event.location.city}, {event.location.country}\n                                                        </span>\n                                                    )}\n                                                </td>\n                                            </tr>\n                                            \n                                            {expandedRows.has(event.id) && (\n                                                <tr className=\"event-details-row\">\n                                                    <td colSpan={9}>\n                                                        <div className=\"event-details\">\n                                                            <div className=\"details-section\">\n                                                                <h4>üìù Event Details</h4>\n                                                                {formatDetails(event.details)}\n                                                            </div>\n                                                            \n                                                            <div className=\"details-section\">\n                                                                <h4>üåê Technical Information</h4>\n                                                                <div className=\"detail-item\">\n                                                                    <span className=\"detail-key\">User Agent:</span>\n                                                                    <span className=\"detail-value\">{event.userAgent}</span>\n                                                                </div>\n                                                                <div className=\"detail-item\">\n                                                                    <span className=\"detail-key\">Event ID:</span>\n                                                                    <span className=\"detail-value\">{event.id}</span>\n                                                                </div>\n                                                                {event.metadata && Object.keys(event.metadata).length > 0 && (\n                                                                    <div className=\"detail-item\">\n                                                                        <span className=\"detail-key\">Metadata:</span>\n                                                                        <div className=\"metadata-content\">\n                                                                            {formatDetails(event.metadata)}\n                                                                        </div>\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </td>\n                                                </tr>\n                                            )}\n                                        </React.Fragment>\n                                    ))}\n                                </tbody>\n                            </table>\n                        </div>\n                        \n                        {sortedEvents.length === 0 && (\n                            <div className=\"empty-state\">\n                                <div className=\"empty-icon\">üìã</div>\n                                <h3>No audit events found</h3>\n                                <p>Try adjusting your filters to see more results</p>\n                            </div>\n                        )}\n                    </div>\n                )}\n                \n                {viewMode === 'timeline' && (\n                    <div className=\"timeline-view\">\n                        <h3>üìà Timeline View (Coming Soon)</h3>\n                        <p>Interactive timeline visualization will be available in the next update.</p>\n                    </div>\n                )}\n                \n                {viewMode === 'chart' && (\n                    <div className=\"analytics-view\">\n                        <h3>üìâ Analytics Dashboard (Coming Soon)</h3>\n                        <p>Advanced analytics and visualization charts will be available in the next update.</p>\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}\n\nexport default AuditTrail;"